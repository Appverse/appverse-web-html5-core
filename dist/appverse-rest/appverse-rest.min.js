/*! appverse-web-html5-core - v1.0.0 - */
!function(){"use strict";angular.module("appverse.rest",["restangular","appverse.configuration","appverse.utils"]).run(["$injector","$log","Restangular","ModuleSeeker","REST_CONFIG",function(a,b,c,d,e){function f(){var b=a.get("RESTFactory"),c=a.get("$log"),e=a.get("SECURITY_GENERAL");if(d.exists("appverse.security")){var f=a.get("Oauth_RequestWrapper");if(e.securityEnabled)return b.wrapRequestsWith(f),void c.debug("REST communication is secure. Security is enabled. REST requests will be wrapped with authorization headers.")}c.debug("REST communication is not secure. Security is not enabled.")}function g(){if(d.exists("appverse.cache")){var b=a.get("RESTFactory"),c=a.get("avCacheFactory"),e=c.getHttpCache();b.setCache(e)}}if(b.info("appverse.rest run"),f(),g(),c.setBaseUrl(e.BaseUrl),c.setExtraFields(e.ExtraFields),c.setParentless(e.Parentless),c.setRestangularFields(e.RestangularFields),c.setMethodOverriders(e.MethodOverriders),c.setFullResponse(e.FullResponse),e.DefaultHeaders&&c.setDefaultHeaders(e.DefaultHeaders),c.setRequestSuffix(e.RequestSuffix),c.setUseCannonicalId(e.UseCannonicalId),c.setEncodeIds(e.EncodeIds),e.HATEOAS){var h="content",i="href",j="links";c.setResponseExtractor(function(a,b){var c=a;if("getList"===b&&h in a){for(var d=0;d<a[h].length;d++)a[h][d][i]=a[h][d][j][0][i],delete a[h][d][j];c=a[h],delete a[h];for(var e in a)c[e]=a[e]}return c})}}])}(),function(){"use strict";angular.module("appverse.rest").directive("avRestGet",["$log","Restangular","$rootScope","$timeout","REST_CONFIG","RESTFactory",function(a,b,c,d,e,f){return{restrict:"A",link:function(g,h,i){a.debug("avRestGet directive",i);var j,k="Getting",l="Error";i.restName?j=i.restName:(j=i.avRestGet.split("/").reverse()[0],i.restId&&"s"===j.charAt(j.length-1)&&(j=j.substr(0,j.length-1))),g[j+k]=!0,g.$watchCollection(function(){return[i.avRestGet,i.restId,i.restName]},function(g,h,m){function n(b){a.debug("onSuccess",b),d(function(){m[j+k]=!1,m[j]=b;var a=f.afterRoute[j];a&&a(),i.restThen&&m.$eval(i.restThen)},e.Timeout)}function o(b){a.debug("onError",b),d(function(){m[j+k]=!1,m[j+l]=!0,c[j+"Errors"]||(c[j+"Errors"]=[]),c[j+"Errors"].push(b)},e.Timeout)}a.debug("avRestGet watch "+j+":",g),m[j+l]=!1,i.restId?b.all(i.avRestGet).one(i.restId).get().then(n,o):b.all(i.avRestGet).getList().then(n,o)})}}}]).directive("avRestRemove",["$log","$rootScope","$timeout","REST_CONFIG","RESTFactory",function(a,b,c,d,e){return{restrict:"A",link:function(f,g,h){g.bind("click",function(){function g(b){a.debug("onSuccess",b),c(function(){var a;a=l.getParentList?l.getParentList():f[m];var b=a.indexOf(l);if(b>-1){a.splice(b,1);var c=e.afterRoute[m];c&&c()}},d.Timeout)}function i(e){a.debug("onError",e),c(function(){delete l[j],f[m+k]=!0,b[m+"Errors"]||(b[m+"Errors"]=[]),b[m+"Errors"].push(e)},d.Timeout)}var j="$removing",k="Error",l=f.$eval(h.avRestRemove),m=l.route.split("/").reverse()[0];if(a.debug("avRestRemove directive",l),!h.restIf||f.$eval(h.restIf)){l[j]=!0;var n=e.afterRoute[m];n&&n(),l.remove().then(g,i)}})}}}]).directive("avRestSave",["$log","$rootScope","Restangular","$timeout","REST_CONFIG","RESTFactory",function(a,b,c,d,e,f){return{restrict:"A",link:function(g,h,i){h.bind("click",function(){function h(b){a.debug("onSuccess",b),d(function(){o.fromServer?k[p]=b:(k.push(b),delete k[m]);var a=f.afterRoute[l];a&&a()},e.Timeout)}function j(c){a.debug("onError",c),d(function(){g[l+n]=!0,p>-1?delete k[p][m]:delete k[m];var a=f.afterRoute[l];a&&a(),b[l+"Errors"]||(b[l+"Errors"]=[]),b[l+"Errors"].push(c)},e.Timeout)}var k,l,m="$saving",n="Error",o=g.$eval(i.avRestSave),p=-1;if(o.getParentList?(k=o.getParentList(),l=k.route.split("/").reverse()[0]):(l=o.route.split("/").reverse()[0],k=g[l]),a.debug("avRestSave directive",o),!i.restIf||g.$eval(i.restIf)){g[l+n]=!1,o=angular.copy(o),delete o.editing,o.fromServer?(o.put().then(h,j),k.some(function(a,b){if(a[c.configuration.restangularFields.id]===o[c.configuration.restangularFields.id])return p=b,!0}),k[p][m]=!0):(delete o[c.configuration.restangularFields.id],k.post(o).then(h,j),k[m]=!0);var q=f.afterRoute[l];q&&q()}})}}}]).directive("avRestAdd",["$log",function(a){return{restrict:"A",link:function(b,c,d){c.bind("click",function(){var c=b.$eval(d.avRestAdd);a.debug("avRestAdd directive",c),c.unshift({editing:!0,getParentList:function(){return c}}),b.$applyAsync()})}}}]).directive("avRestClone",["$log",function(a){return{restrict:"A",link:function(b,c,d){c.bind("click",function(){var c=b.$eval(d.avRestClone),e=c.getParentList();a.debug("avRestClone directive",c);var f=c.clone();f.editing=!0,f.fromServer=!1,e.unshift(f),b.$applyAsync()})}}}]).directive("avRestEdit",["$log",function(a){return{restrict:"A",link:function(b,c,d){c.bind("click",function(){var c=b.$eval(d.avRestEdit);a.debug("avRestEdit directive",c),b.copy=c.clone(),c.editing=!0,b.$applyAsync()})}}}]).directive("avRestCancel",["$log",function(a){return{restrict:"A",link:function(b,c,d){c.bind("click",function(){a.debug("avRestCancel directive",b);var c,e=b.$eval(d.avRestCancel);c=e.getParentList?e.getParentList():b[d.restName||d.avRestCancel+"s"];var f=c.indexOf(e);f>-1&&(b.copy?c.splice(f,1,b.copy):c.splice(f,1)),b.$applyAsync()})}}}])}(),function(){"use strict";function a(a,b,c,d,e){var f={afterRoute:{}};return f.wrapRequestsWith=function(a){d=a.wrapRequest(d)},f.setCache=function(a){d.setResponseInterceptor(function(b,c){return a&&!0===e.NoCacheHttpMethods[c]&&a.removeAll(),b})},f.setAfterRoute=function(a,b){f.afterRoute[a]=b},f.readBatch=function(a){var e=b.defer();return c.get(d.configuration.baseUrl+"/"+a+d.configuration.suffix).success(function(a){e.resolve(a)}),e.promise},f.readParallelMultipleBatch=function(a){var c=[];return angular.forEach(a,function(a){var d=b.defer();f.readBatch(a).then(function(a){d.resolve(a)},function(){d.reject()}),c.push(d.promise)}),b.all(c)},f}a.$inject=["$log","$q","$http","Restangular","REST_CONFIG"],angular.module("appverse.rest").factory("RESTFactory",a)}();
//# sourceMappingURL=appverse-rest.min.js.map